<!DOCTYPE html>
<html lang="th">
  <%- include('partials/head') %>
  <body
    class="min-h-screen flex flex-col bg-gradient-to-b from-black via-neutral-900 to-zinc-950 text-white font-[Prompt]"
  >
    <%- include('partials/navbar') %>

    <main class="flex-1 mx-auto max-w-3xl px-4 py-14">
      <div
        class="bg-neutral-900/80 border border-red-600/40 rounded-2xl shadow-[0_0_25px_rgba(229,9,20,0.25)] p-8 backdrop-blur-md"
      >
        <h1
          class="font-bangers text-4xl text-red-500 drop-shadow-[0_0_12px_rgba(229,9,20,0.8)] mb-2"
        >
          <span id="formTitle">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</span>
        </h1>
        <p class="text-gray-300 text-sm mb-6">
          ‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
        </p>

        <form id="eventForm" class="grid gap-5">
          <label class="grid gap-1">
            <span class="text-sm text-gray-300">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
            <input
              name="title"
              required
              class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
            />
          </label>

          <label class="grid gap-1">
            <span class="text-sm text-gray-300">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</span>
            <textarea
              name="description"
              rows="3"
              required
              class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
            ></textarea>
          </label>

          <label class="grid gap-1">
            <span class="text-sm text-gray-300">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)</span>
            <input
              name="image_url"
              placeholder="https://..."
              class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
            />
          </label>

          <div class="grid md:grid-cols-2 gap-4">
            <label class="grid gap-1">
              <span class="text-sm text-gray-300">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
              <input
                name="date"
                type="date"
                required
                class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
              />
            </label>

            <label class="grid gap-1">
              <span class="text-sm text-gray-300">‡πÄ‡∏ß‡∏•‡∏≤</span>
              <input
                name="time"
                type="time"
                required
                class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
              />
            </label>
          </div>

          <div class="grid md:grid-cols-2 gap-4">
            <label class="grid gap-1">
              <span class="text-sm text-gray-300">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</span>
              <input
                name="location"
                required
                class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
              />
            </label>

            <label class="grid gap-1">
              <span class="text-sm text-gray-300">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
              <select
                name="category"
                class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
              >
                <option value="Concert">üé§ Concert</option>
                <option value="Conference" selected>üíº Conference</option>
                <option value="Sports">üèÜ Sports</option>
                <option value="Festival">üé™ Festival</option>
                <option value="Workshop">üß† Workshop</option>
              </select>
            </label>
          </div>

          <div class="grid md:grid-cols-2 gap-4">
            <label class="grid gap-1">
              <span class="text-sm text-gray-300">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</span>
              <input
                name="price"
                type="number"
                step="0.01"
                required
                class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
              />
            </label>

            <label class="grid gap-1">
              <span class="text-sm text-gray-300">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡πã‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
              <input
                name="available_tickets"
                type="number"
                required
                class="rounded-lg bg-neutral-800 border border-red-500/40 focus:ring-2 focus:ring-red-600 outline-none px-3 py-2 text-white"
              />
            </label>
          </div>

          <button
            class="w-full py-3 rounded-lg bg-red-600 hover:bg-red-700 text-white font-semibold shadow-[0_0_15px_rgba(229,9,20,0.6)] transition hover:scale-[1.02]"
            type="submit"
          >
            <i class="fa-solid fa-floppy-disk mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
          </button>
        </form>
      </div>
    </main>

    <script>
      const form = document.getElementById("eventForm");
      const params = new URLSearchParams(window.location.search);
      const editId = params.get("edit");
      const formTitle = document.getElementById("formTitle");

      if (editId) {
        formTitle.textContent = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°";
        fetch(`/organizer/event/${editId}`)
          .then((res) => res.json())
          .then((data) => {
            Object.keys(data).forEach((k) => {
              if (form[k]) form[k].value = data[k];
            });
          });
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fd = new FormData(form);
        const body = Object.fromEntries(fd.entries());

        try {
          const method = editId ? "PUT" : "POST";
          const url = editId
            ? `/organizer/event/${editId}`
            : "/organizer/create-event";
          const r = await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          });
          const data = await r.json();

          if (r.ok) {
            Swal.fire({
              icon: "success",
              title: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
              text: data.msg || "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
              confirmButtonText: "‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î",
              confirmButtonColor: "#e50914",
              background: "#1a1a1a",
              color: "#fff",
              iconColor: "#e50914",
            }).then(() => (window.location.href = "/organizer/dashboard"));
          } else {
            Swal.fire({
              icon: "warning",
              title: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
              text: data.msg || "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
              confirmButtonColor: "#e50914",
              background: "#1a1a1a",
              color: "#fff",
              iconColor: "#e50914",
            });
          }
        } catch (err) {
          Swal.fire({
            icon: "error",
            title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
            text: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ",
            confirmButtonColor: "#e50914",
            background: "#1a1a1a",
            color: "#fff",
            iconColor: "#e50914",
          });
        }
      });
    </script>

    <%- include('partials/footer') %>
  </body>
</html>