<!DOCTYPE html>
<html lang="th">
  <%- include('partials/head') %>
  <body class="gachi-bg min-h-screen text-lime-50">
    <%- include('partials/navbar') %>

    <main class="mx-auto max-w-md px-4 py-14">
      <div class="gachi-panel">
        <h1 class="font-bangers text-4xl text-lime-300 drop-shadow-neon">Sign In</h1>
        <p class="mt-1 opacity-80">เข้าสู่ระบบเพื่อจัดการหรือซื้อตั๋วอีเวนต์สุดมันส์</p>

        <form id="signinForm" method="post" action="/login_user" class="mt-6 grid gap-4">
          <label class="grid gap-1">
            <span class="label">อีเมล</span>
            <input name="email" type="email" required class="input">
          </label>

          <label class="grid gap-1">
            <span class="label">รหัสผ่าน</span>
            <input name="password" type="password" required minlength="6" class="input">
          </label>

          <button class="btn-primary w-full mt-2">เข้าสู่ระบบ</button>
        </form>

        <div id="signinMsg" class="mt-4 text-sm"></div>

        <p class="mt-6 text-lime-200/80 text-sm">
          ยังไม่มีบัญชี? <a href="/signup" class="underline text-lime-300">สมัครสมาชิก</a>
        </p>
      </div>
    </main>

    <script>
      document.getElementById('signinForm').addEventListener('submit', async (e)=>{
        e.preventDefault()
        const form = e.target
        const fd = new FormData(form)
        const body = { email: fd.get('email'), password: fd.get('password') }
        const msg = document.getElementById('signinMsg')
        msg.textContent = 'กำลังตรวจสอบ...'
        try {
          const r = await fetch('/login_user', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify(body)
          })
          const data = await r.json()
          if (r.ok){
            msg.className = 'mt-4 text-sm text-lime-300'
            msg.textContent = data.msg + ' กำลังพาไปหน้าแรก...'
            setTimeout(()=>window.location.href=data.redirectPath, 1000)
          } else {
            msg.className = 'mt-4 text-sm text-rose-300'
            msg.textContent = data.msg || 'เข้าสู่ระบบไม่สำเร็จ'
          }
        } catch (err) {
          msg.className = 'mt-4 text-sm text-rose-300'
          msg.textContent = 'เกิดข้อผิดพลาด'
        }
      })
    </script>

    <%- include('partials/footer') %>
  </body>
</html>
